<div class="logi-container">
  <!-- Nagłówek strony -->
  <div class="logi-header">
    <div class="header-content">
      <i class="pi pi-list header-icon"></i>
      <div>
        <h1>Historia logów systemowych</h1>
        <p class="subtitle">Przegląd wszystkich zdarzeń w systemie</p>
      </div>
    </div>
  </div>

  <!-- Panel kontrolny -->
  <div class="control-panel">
    <div class="control-left">
      <span class="filter-label">Filtruj:</span>
      <p-select
        [options]="filterOptions"
        [(ngModel)]="selectedFilter"
        (onChange)="onFilterChange()"
        placeholder="Wybierz typ zdarzenia"
        class="filter-select"
      />
    </div>
    <div class="control-right">
      <p-button
        icon="pi pi-chevron-left"
        (click)="prev()"
        [disabled]="isFirstPage()"
        [rounded]="true"
        [text]="true"
        severity="secondary"
      />
      <p-button
        icon="pi pi-refresh"
        (click)="reset()"
        [rounded]="true"
        [text]="true"
        severity="secondary"
        pTooltip="Resetuj stronę"
      />
      <p-button
        icon="pi pi-chevron-right"
        (click)="next()"
        [disabled]="isLastPage()"
        [rounded]="true"
        [text]="true"
        severity="secondary"
      />
      <p-button
        icon="pi pi-sync"
        (click)="loadLogs()"
        [rounded]="true"
        [text]="true"
        severity="info"
        pTooltip="Odśwież dane"
      />
    </div>
  </div>

  <!-- Statystyki -->
  <div class="stats-row">
    <div class="stat-card">
      <i class="pi pi-list"></i>
      <div class="stat-info">
        <span class="stat-value">{{ logs.length }}</span>
        <span class="stat-label">Wszystkich logów</span>
      </div>
    </div>
    <div class="stat-card info">
      <i class="pi pi-info-circle"></i>
      <div class="stat-info">
        <span class="stat-value">{{ getCountByType('INFO') }}</span>
        <span class="stat-label">Info</span>
      </div>
    </div>
    <div class="stat-card warning">
      <i class="pi pi-exclamation-triangle"></i>
      <div class="stat-info">
        <span class="stat-value">{{ getCountByType('WARNING') }}</span>
        <span class="stat-label">Ostrzeżenia</span>
      </div>
    </div>
    <div class="stat-card error">
      <i class="pi pi-times-circle"></i>
      <div class="stat-info">
        <span class="stat-value">{{ getCountByType('ERROR') }}</span>
        <span class="stat-label">Błędy</span>
      </div>
    </div>
  </div>

  <!-- Tabela logów -->
  <div class="table-container">
    <p-table
      [value]="logs"
      [paginator]="true"
      [rows]="rows"
      [first]="first"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Wyświetlane {first} - {last} z {totalRecords} wpisów"
      (onPage)="pageChange($event)"
      [rowsPerPageOptions]="[10, 25, 50]"
      [loading]="loading"
      [globalFilterFields]="['opis', 'typ_logu', 'typ_zdarzenia', 'nazwa_uzytkownika']"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <!-- (opcjonalnie) kolumna z ID logu -->
          <th pSortableColumn="_id" style="width: 180px">
            <div class="header-cell">
              <i class="pi pi-key"></i>
              ID
              <p-sortIcon field="_id"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="createdAt" style="width: 160px">
            <div class="header-cell">
              <i class="pi pi-calendar"></i>
              Data
              <p-sortIcon field="createdAt"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="typ_logu" style="width: 110px">
            <div class="header-cell">
              <i class="pi pi-tag"></i>
              Typ
              <p-sortIcon field="typ_logu"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="typ_zdarzenia" style="width: 140px">
            <div class="header-cell">
              <i class="pi pi-bolt"></i>
              Zdarzenie
              <p-sortIcon field="typ_zdarzenia"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="opis" style="min-width: 260px">
            <div class="header-cell">
              <i class="pi pi-align-left"></i>
              Opis
              <p-sortIcon field="opis"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="uzytkownik_id" style="width: 110px">
            <div class="header-cell">
              <i class="pi pi-user"></i>
              Użytkownik (ID)
              <p-sortIcon field="uzytkownik_id"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="nazwa_uzytkownika" style="width: 160px">
            <div class="header-cell">
              <i class="pi pi-user-edit"></i>
              Nazwa użytkownika
              <p-sortIcon field="nazwa_uzytkownika"></p-sortIcon>
            </div>
          </th>

          <th pSortableColumn="seans_id" style="width: 100px">
            <div class="header-cell">
              <i class="pi pi-video"></i>
              Seans
              <p-sortIcon field="seans_id"></p-sortIcon>
            </div>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-log>
        <tr class="log-row" [ngClass]="'log-row-' + log.typ_logu.toLowerCase()">
          <!-- (opcjonalnie) kolumna z ID -->
          <td>
            <span class="id-cell">{{ log._id }}</span>
          </td>

          <td>
            <span class="date-cell">{{ formatDate(log.createdAt) }}</span>
          </td>

          <td>
            <p-tag
              [value]="log.typ_logu"
              [severity]="getTypLoguSeverity(log.typ_logu)"
              [rounded]="true"
            ></p-tag>
          </td>

          <td>
            <p-tag
              [value]="log.typ_zdarzenia"
              [severity]="getTypZdarzeniaSeverity(log.typ_zdarzenia)"
            ></p-tag>
          </td>

          <td>
            <span class="opis-cell">{{ log.opis }}</span>
          </td>

          <td class="center-cell">
        <span *ngIf="log.uzytkownik_id" class="user-badge">
          <i class="pi pi-user"></i> {{ log.uzytkownik_id }}
        </span>
            <span *ngIf="!log.uzytkownik_id" class="empty-cell">—</span>
          </td>

          <td>
            <span *ngIf="log.nazwa_uzytkownika">{{ log.nazwa_uzytkownika }}</span>
            <span *ngIf="!log.nazwa_uzytkownika" class="empty-cell">—</span>
          </td>

          <td class="center-cell">
        <span *ngIf="log.seans_id" class="seans-badge">
          #{{ log.seans_id }}
        </span>
            <span *ngIf="!log.seans_id" class="empty-cell">—</span>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            <div class="empty-state">
              <i class="pi pi-inbox"></i>
              <h3>Brak logów</h3>
              <p>Nie znaleziono żadnych logów do wyświetlenia</p>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="8">
            <div class="loading-state">
              <i class="pi pi-spin pi-spinner"></i>
              <span>Ładowanie logów...</span>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
